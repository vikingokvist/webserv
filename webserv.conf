# Start of first server block
server {
    listen 127.0.0.1:8080;                          # Bind to this IP and port
    server_name mysite.com www.mysite.com;         # Accept requests for these hostnames

    client_max_body_size 2M;                        # Limit on request body size (e.g. file uploads)
    error_page 404 /errors/404.html;               # Custom error page for 404
    error_page 500 /errors/500.html;               # Custom error page for 500

    # Root route (homepage or general path)
    location / {
        root /var/www/html;                        # Base path to serve files from
        index index.html;                          # Default file if directory is requested
        methods GET POST;                          # Accepted HTTP methods
        autoindex off;                             # Do not list directory contents
    }

    # Static image folder
    location /images {
        root /var/www/images;                      # Serve static images from this path
        autoindex on;                              # Allow directory listing if no index
    }

    # Redirection
    location /redirect {
        return 301 http://example.com;             # Redirect to another URL
    }

    # File upload path
    location /upload {
        root /var/www/uploads;                     # Serve uploaded files from here
        methods POST;                              # Only allow POST method
        upload_store /var/www/uploads;             # Directory to store uploaded files
    }

    # CGI script execution for .py
    location /cgi {
        root /var/www/cgi;                         # Serve from this base path
        methods GET POST;                          # Allow CGI scripts to receive GET/POST
        cgi_ext .py;                               # Run .py files as CGI scripts
    }
}

# Second server, different port
server {
    listen 0.0.0.0:8081;                           # Accept connections on all interfaces, port 8081
    client_max_body_size 1M;

    location / {
        root /usr/share/nginx/html;
        index index.php;
        methods GET POST;
        cgi_ext .php;                              # Run .php files as CGI
    }
}
